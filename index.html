<html>
<script src="https://unpkg.com/web-audio-daw"></script>
  <!--<script src="wad.js"></script>-->
2f]i  
<script>
  var amen;
  var amenchops = [];
  var sprites = {};
  var iterator;
  var running = false;
  var notset = true;
  var easing_range;
  var valhist = [0,0,0,0,0];
  var maxval = 1;

  Wad.logs.verbosity = 2;

  function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  }

  function make_amen() {
    for (var i = 1; i < 17; ++i) {
      amenchops[amenchops.length] = new Wad({source: `amen${i}.wav`});
    }
  }

  function figureOutWhichSlice(count) {
    var fuckery = document.getElementById("fuckery").value;
    var intensity = 0;
    if(fuckery != 0) {
      while (fuckery > 1 || fuckery < 0) {
        fuckery = Math.abs(fuckery / 1400000000) * Math.random();
      }
      fuckery = fuckery > 0.3 ? fuckery < .6 ? 0 : Math.random() > .5 ? 1 : -1 : 0;
    }
    fuckery = 0; // FIXME: fuckery doesnt even work lol :l
    var histmod = 0;
    console.log(fuckery, maxval, valhist);
    for(var i = 0; i < valhist.length; ++i) {
      maxval = Math.max(valhist[i], maxval);
      histmod = histmod + valhist[i];
    }
    maxval = maxval * .85;
    document.getElementById("intensities").innerHTML = `histvals: ${valhist[0]}, ${valhist[1]}, ${valhist[2]}, ${valhist[3]}, ${valhist[4]}`;
    intensity = Math.floor(histmod / maxval)
    result = Math.abs(Math.floor(((count + fuckery) % 4 + intensity * 4 ) % 16));
    console.log("count: " + count + " \nintensity: " + intensity + "\nfuckery: " + fuckery + "\n result: " + result);
    return result;
  }

  function start_linacc_modulation() {
    var sensor;
    try {
      sensor = new LinearAccelerationSensor();
      sensor.addEventListener('reading', () => {
        valhist = [Math.hypot(sensor.x, sensor.y, sensor.z), valhist.slice(0, 4).flat()];
        document.getElementById.innerHTML.append(`<br />got reading: ${sensor.x}, ${sensor.y}, ${sensor.z}`);
      });
    }
    catch {
      alert("no linear acceleration sensor w/o frequency hint");
    }
  }

  function play_amen() {
    running = true;
    var delay;
    var count = 0;
    var recursefunc;
    recursefunc = function() {
      if (running) {
        delay = document.getElementById("rate").value;
        count = count + 1;
        var which = figureOutWhichSlice(count);
        if (amenchops[which]) {
          amenchops[which].play();
          setTimeout(recursefunc, delay);
        } else { alert("whoops again! " + which) }
      }
    };

    if (notset || !running) {
      setTimeout(recursefunc, delay);
      notset = false;
    }
  }

  function stop_amen() {
    running = false;
  }
</script>
<body>
  aaaaa >:c <br />
  <button onclick="make_amen()">make amen!</button> <br/>
  <button onclick="play_amen()">play amen!</button> <br/>
  <button onclick="stop_amen()">stop amen!</button> <br/>
  <button onclick="start_linacc_modulation()">start accel mod!</button> <br/>
  <input id="rate" type="text" value="333"></input> milliseconds <br/>
  <input id="easing_range" type=text" value="0"></input> &lt;- easing range <br />
  <!--input id="intensity" type="text" value="0"></input> &lt;- 0,1,2,3 <br/-->
  <input id="fuckery" type="text" value="0"></input> &lt;- uhhh <br />
  <p id="intensities"></p>
  <p id="loggery"></p>
</body>
</html>
