<html>
<script src="https://unpkg.com/web-audio-daw"></script>
  <!--<script src="wad.js"></script>-->
<script>
  var amen;
  var amenchops = [];
  var sprites = {};
  var iterator;
  var running = false;
  var notset = true;

  Wad.logs.verbosity = 2;

  function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
      }
  }  

  function make_amen() {
    for (var i = 1; i < 4; ++i) {
      var key = "b" + i;
      for(var j = 1; j < 5; ++j) {
        sprites[key + "b" + j] =
          [ (i * j - 1) / 12, (i * j) / 12 ];
      }
    }

    for (var i = 1; i < 13; ++i) {
      amenchops[amenchops.length] = new Wad({source: `amen${i}.wav`});
    }

    iterator = new Wad.SoundIterator({
      files: amenchops,
    });
  }

  function play_amen() {
    running = true;
    var recursefunc;
    var time;
    recursefunc = function() {
      var count = 0;
      if (running) {
        time = document.getElementById("rate").value;
        var which = Math.floor(((Math.random() * 51818) % 6) * 2 - (count % 2));
        if (which > 11) { alert("whoops") };
        if (amenchops[which]) {
          iterator.add(amenchops[which]);
          iterator.play();
          setTimeout(recursefunc, time);
        } else { alert("whoops again! " + which) }
      }
    };
    if (notset) {
      setTimeout(recursefunc, time);
      notset = false;
    }
  }

  function stop_amen() {
    running = false;
  }
</script>
<body>
  aaaaa >:c <br />
  <button onclick="make_amen()">make amen!</button> <br />
  <button onclick="play_amen()">play amen!</button> <br />
  <button onclick="stop_amen()">stop amen!</button> <br />
  <input id="rate" type="text" value="440"></input>
</body>
</html>
